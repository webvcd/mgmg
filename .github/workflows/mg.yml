name: Sync Remote File Hourly

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write  # ç»™äºˆå†™å…¥å†…å®¹çš„æƒé™

jobs:
  sync-file:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # ç§»é™¤ token å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤çš„ GITHUB_TOKEN
        fetch-depth: 0

    - name: Setup Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: Download remote file
      run: |
        # ä¸‹è½½æ–‡ä»¶
        curl -s -f -o interface.txt https://raw.githubusercontent.com/develop202/migu_video/refs/heads/main/interface.txt
        
        if [ $? -ne 0 ]; then
          echo "âŒ æ–‡ä»¶ä¸‹è½½å¤±è´¥"
          exit 1
        fi
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–
        if git diff --quiet interface.txt 2>/dev/null; then
          echo "ğŸ“ æ–‡ä»¶æ²¡æœ‰å˜åŒ–"
          echo "NO_CHANGES=true" >> $GITHUB_ENV
        else
          echo "ğŸ“¤ æ–‡ä»¶æœ‰å˜åŒ–ï¼Œå°†æäº¤æ›´æ–°"
          echo "NO_CHANGES=false" >> $GITHUB_ENV
          
          # æ˜¾ç¤ºå˜åŒ–
          echo "å˜åŒ–å†…å®¹ï¼š"
          git diff interface.txt | head -20
        fi

    - name: Commit and push if changed
      if: env.NO_CHANGES == 'false'
      run: |
        git add interface.txt
        git commit -m "ğŸ”„ æ¯å°æ—¶åŒæ­¥æ›´æ–° [$(date +'%H:%M')]"
        git push origin main

    - name: Log success with changes
      if: env.NO_CHANGES == 'false' && success()
      run: echo "âœ… æ–‡ä»¶å·²æ›´æ–°å¹¶æäº¤"

    - name: Log no changes
      if: env.NO_CHANGES == 'true'
      run: echo "ğŸ“ æ–‡ä»¶æ— å˜åŒ–ï¼Œæ— éœ€æ›´æ–°"
