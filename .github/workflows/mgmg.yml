name: 定时下载migu interface.txt
on:
  schedule:
    - cron: '0 * * * *'  # 1小时整点触发
  workflow_dispatch:     # 手动触发

jobs:
  download-file:
    runs-on: ubuntu-latest
    steps:
      - name: 检出仓库（指定主分支+完整历史）
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0
          persist-credentials: true # 保留推送权限

      - name: 强制下载覆盖文件
        run: |
          # 强制下载，失败直接退出，确保文件最新
          curl -fsSL -o interface.txt "https://raw.githubusercontent.com/develop202/migu_video/main/interface.txt"
          ls -l interface.txt # 验证文件存在

      - name: 手动Git强制提交+推送（核心：绕过Action的检查）
        run: |
          # 配置Git用户（和Action保持一致）
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          # 强制添加文件，无视缓存/变更
          git add interface.txt --force
          # 强制提交，即使无变更（用--allow-empty）
          git commit -m "定时强制更新：migu interface.txt [自动提交]" --allow-empty
          # 强制推送到main分支，解决权限/分支差异问题
          git push origin main --force
