name: 定时下载migu
on:
  schedule:
    - cron: '0 * * * *'  # 1小时整点触发
  workflow_dispatch:     # 手动触发开关

jobs:
  download-file:
    runs-on: ubuntu-latest
    steps:
      - name: 检出仓库
        uses: actions/checkout@v4

      - name: 强制下载并覆盖interface.txt
        run: |
          # -f 强制覆盖已有文件 -s 静默下载（仅报错输出）-L 跟随重定向
          curl -f -s -L -o interface.txt "https://raw.githubusercontent.com/develop202/migu_video/main/interface.txt"
          ls -l interface.txt  # 验证文件存在
          git add interface.txt # 强制加入暂存区（核心：无变更也标记）

      - name: 强制提交并推送（无变更也提交）
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "定时强制更新：migu interface.txt [自动提交]"
          file_pattern: interface.txt
          skip_dirty_check: true # 跳过文件变更检查（关键：强制提交）
