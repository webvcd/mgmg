name: Hourly Sync Interface File

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Git
      run: |
        git config --global user.name "Auto Sync Bot"
        git config --global user.email "auto-sync@noreply.github.com"

    - name: Download file
      run: |
        # ä¸‹è½½æ–‡ä»¶
        wget -q -O interface.txt https://raw.githubusercontent.com/develop202/migu_video/refs/heads/main/interface.txt
        
        # éªŒè¯æ–‡ä»¶éç©º
        if [ ! -s interface.txt ]; then
          echo "é”™è¯¯ï¼šä¸‹è½½çš„æ–‡ä»¶ä¸ºç©º"
          exit 1
        fi
        
        echo "âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸ"
        echo "å¤§å°: $(wc -l < interface.txt) è¡Œ"
        echo "å­—ç¬¦æ•°: $(wc -c < interface.txt) å­—èŠ‚"

    - name: Auto commit
      run: |
        # æ·»åŠ æ–‡ä»¶
        git add interface.txt
        
        # æ€»æ˜¯æäº¤ï¼Œä½¿ç”¨ä¸åŒçš„æäº¤ä¿¡æ¯
        if git diff --cached --quiet; then
          echo "æ²¡æœ‰å˜åŒ–ï¼Œåˆ›å»ºç©ºæäº¤"
          git commit --allow-empty -m "ğŸ• å®šæœŸæ£€æŸ¥ [$(date +'%Y-%m-%d %H:%M')] - æ— å˜åŒ–"
        else
          echo "æ£€æµ‹åˆ°å˜åŒ–ï¼Œæäº¤æ›´æ–°"
          git commit -m "ğŸ”„ åŒæ­¥æ›´æ–° [$(date +'%Y-%m-%d %H:%M')]"
        fi
        
        # æ¨é€
        git push origin main
